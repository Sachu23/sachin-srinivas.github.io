{"version":3,"file":"index.js","sources":["../src/Child.tsx","../src/Container.tsx"],"sourcesContent":["import React from 'react';\nimport { SpringHelperConfig } from 'react-motion-prefixed';\nimport { Middleware } from './interfaces';\n\ninterface Props {\n  factorX?: number;\n  factorY?: number;\n  springConfig?: SpringHelperConfig;\n  children?: JSX.Element | JSX.Element[];\n  className?: string;\n  updateStyles?: Middleware | React.CSSProperties;\n  inverted?: boolean;\n}\n\nconst MouseParallaxChild = ({ children }: Props) => <> {children} </>;\n\nexport default MouseParallaxChild;\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { Motion, spring } from 'react-motion-prefixed';\n\ninterface Props {\n  children: JSX.Element[] | JSX.Element;\n  resetOnLeave?: boolean;\n  useWindowMouseEvents?: boolean;\n  inverted?: boolean;\n  containerStyles?: React.CSSProperties;\n  className?: string;\n  globalFactorX?: number;\n  globalFactorY?: number;\n  enableCSSTransition?: boolean;\n  enabled?: boolean;\n}\n\n// Helper function to check if a variable is a function\nconst isFunction: (value: any) => boolean = (value) =>\n  value &&\n  (Object.prototype.toString.call(value) === '[object Function]' ||\n    'function' === typeof value ||\n    value instanceof Function);\n\nconst MouseParallaxContainer = ({\n  children,\n  resetOnLeave,\n  useWindowMouseEvents,\n  inverted,\n  containerStyles,\n  className,\n  globalFactorX = 1,\n  globalFactorY = 1,\n  enableCSSTransition,\n  enabled = true,\n}: Props) => {\n  // Convert one-child cases into one dimensional array to map over\n  if (!Array.isArray(children)) children = [children];\n\n  const [offset, setOffset] = useState<[number, number]>([0, 0]);\n  // Container reference with callback to use it inside of useEffect\n  // prettier-ignore\n  const [containerRef, setContainerRef] = useState<{ current: HTMLDivElement | null; }>({ current: null });\n  const containerRefWithCallback = useCallback((node: any) => {\n    if (node !== null) {\n      setContainerRef({ current: node });\n    }\n  }, []);\n\n  const getMousePosition = useCallback(\n    (e: React.MouseEvent<HTMLDivElement, MouseEvent> | MouseEvent) => {\n      var rect = containerRef.current\n        ? containerRef.current.getBoundingClientRect()\n        : { left: 0, top: 0 };\n      return {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top,\n      };\n    },\n    [containerRef]\n  );\n\n  const mouseMovementHandler = useCallback(\n    (e: React.MouseEvent<HTMLDivElement, MouseEvent> | MouseEvent) => {\n      if (containerRef.current) {\n        var containerHeight = containerRef.current.clientHeight;\n        var containerWidth = containerRef.current.clientWidth;\n        var mousePosition = getMousePosition(e);\n        var relativeToCenter: [number, number] = [\n          containerWidth / 2 - mousePosition.x,\n          containerHeight / 2 - mousePosition.y,\n        ];\n        setOffset(relativeToCenter);\n      }\n    },\n    [containerRef, getMousePosition, inverted]\n  );\n\n  // Use window event handler when useWindowMouseEvents is enabled\n  useEffect(() => {\n    if (enabled) {\n      if (useWindowMouseEvents && containerRef.current) {\n        window.addEventListener('mousemove', mouseMovementHandler, false);\n        if (resetOnLeave)\n          window.addEventListener('mouseout', () => setOffset([0, 0]), false);\n      }\n    }\n    return () => {\n      window.removeEventListener('mousemove', mouseMovementHandler, false);\n      if (resetOnLeave)\n        window.removeEventListener('mouseout', () => setOffset([0, 0]), false);\n    };\n  }, [\n    containerRef,\n    mouseMovementHandler,\n    resetOnLeave,\n    useWindowMouseEvents,\n    enabled,\n  ]);\n\n  return (\n    <>\n      <div\n        className={className && className}\n        id=\"mouse-parallax-container\"\n        style={{ overflow: 'hidden', position: 'relative', ...containerStyles }}\n        ref={containerRefWithCallback}\n        onMouseMove={\n          enabled && !useWindowMouseEvents ? mouseMovementHandler : () => {}\n        }\n        onMouseLeave={\n          enabled && !useWindowMouseEvents && resetOnLeave\n            ? () => setOffset([0, 0])\n            : () => {}\n        }\n      >\n        {children.map(\n          (child, index) =>\n            child && (\n              // Using react-motion to smooth the transition\n              <Motion\n                key={child.key || index}\n                style={\n                  enabled\n                    ? {\n                        x: spring(\n                          offset[0] *\n                            (child.props.factorX || 0) *\n                            globalFactorX *\n                            (child.props.inverted ? -1 : 1) *\n                            (inverted ? -1 : 1),\n                          child.props.springConfig\n                        ),\n                        y: spring(\n                          offset[1] *\n                            (child.props.factorY || 0) *\n                            globalFactorY *\n                            (child.props.inverted ? -1 : 1) *\n                            (inverted ? -1 : 1),\n                          child.props.springConfig\n                        ),\n                      }\n                    : { x: 0, y: 0 }\n                }\n              >\n                {(springOffset) => {\n                  // updateStyles Injection\n                  let [transition, transform, rest] = ['', '', {}];\n\n                  if (child.props.updateStyles) {\n                    if (isFunction(child.props.updateStyles))\n                      // Middleware Function\n                      ({\n                        transition = '',\n                        transform = '',\n                        ...rest\n                      } = child.props.updateStyles({\n                        container: containerRef.current\n                          ? {\n                              x: containerRef.current.clientWidth,\n                              y: containerRef.current.clientHeight,\n                            }\n                          : { x: 0, y: 0 },\n                        px: springOffset,\n                        percentage: containerRef.current\n                          ? {\n                              x:\n                                (springOffset.x /\n                                  containerRef.current.clientWidth) *\n                                2 *\n                                100,\n                              y:\n                                (springOffset.y /\n                                  containerRef.current.clientHeight) *\n                                2 *\n                                100,\n                            }\n                          : { x: 0, y: 0 },\n                      }));\n                    // Extract modified properties from styles\n                    else\n                      ({\n                        transition = '',\n                        transform = '',\n                        ...rest\n                      } = child.props.updateStyles);\n                  }\n\n                  // Combine changes of the properties with additional styles from updateStyles\n                  // prettier-ignore\n                  let transitionStyle = `${enableCSSTransition && 'transform 1e-7s linear'}${transition && ', '}${transition}`;\n                  let transformStyle = `translateX(${springOffset.x}px) translateY(${springOffset.y}px) ${transform}`;\n\n                  // Combine all styles into one style object; Reduce unnecessary CSS styles\n                  let childStyle = {\n                    ...(child.props.factorX || child.props.factorY\n                      ? {\n                          willChange: 'transform',\n                          transition: transitionStyle,\n                          WebkitTransition: transitionStyle,\n                          msTransition: transitionStyle,\n                          transform: transformStyle,\n                          WebkitTransform: transformStyle,\n                          msTransform: transformStyle,\n                        }\n                      : child.props.updateStyles\n                      ? {\n                          transition: transition,\n                          WebkitTransition: transition,\n                          msTransition: transition,\n                          transform: transform,\n                          WebkitTransform: transform,\n                          msTransform: transform,\n                        }\n                      : {}),\n                    ...rest,\n                  };\n\n                  // Render child in container if needed\n                  return child.props.factorX ||\n                    child.props.factorY ||\n                    ((child.props.className || child.props.updateStyles) &&\n                      child.type.name === 'MouseParallaxChild') ? (\n                    <div\n                      className={child.props.className && child.props.className}\n                      style={childStyle}\n                    >\n                      {child}\n                    </div>\n                  ) : (\n                    <>{child}</>\n                  );\n                }}\n              </Motion>\n            )\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default MouseParallaxContainer;\n"],"names":["_a","children","React","createElement","Fragment","resetOnLeave","useWindowMouseEvents","inverted","containerStyles","className","_b","globalFactorX","_c","globalFactorY","enableCSSTransition","_d","enabled","Array","isArray","_e","useState","offset","setOffset","_f","current","containerRef","setContainerRef","containerRefWithCallback","useCallback","node","getMousePosition","e","rect","getBoundingClientRect","left","top","x","clientX","y","clientY","mouseMovementHandler","containerHeight","clientHeight","containerWidth","clientWidth","mousePosition","relativeToCenter","useEffect","window","addEventListener","removeEventListener","id","style","overflow","position","ref","onMouseMove","onMouseLeave","map","child","index","Motion","key","spring","props","factorX","springConfig","factorY","springOffset","value","_g","transition","transform","rest","updateStyles","Object","prototype","toString","call","Function","container","px","percentage","__rest","transitionStyle","concat","transformStyle","childStyle","__assign","willChange","WebkitTransition","msTransition","WebkitTransform","msTransform","type","name"],"mappings":"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"}